<!DOCTYPE html>
<html lang="en">
<head>
    <title>Cross-it!</title>
    <style>
        .game-grid {
            display: grid;
            grid-template-columns: repeat({{ size }}, 50px);  /* Number of columns */
            grid-template-rows: repeat({{ size }}, 50px);  /* Number of rows */
            gap: 5px;  /* Spacing between cells */
        }

        .grid-cell {
            display: flex;
            justify-content: center;
            align-items: center;  /* Center content within cell */
            border: 1px solid black;
            background-color: lightgray;  /* Visual enhancement */
            cursor: pointer;  /* Change cursor to pointer on hover */
        }
        .grid-cell.player0 {
            background-color: darkred;
        }
        .grid-cell.player1 {
            background-color: royalblue;
        }
    </style>
</head>
<body>
    <h1>Cross-it!</h1>
    <div>
        Player: <input type="number" id="player-number" value="0">
        <button type='button' id='start-over-btn' class='hidden'>Start over</button>
    </div>
    <div class="game-grid" id="game-grid">
        {% for row_idx in range(size) %}
            {% for col_idx in range(size) %}
                <div
                    class="grid-cell"
                    data-row="{{ row_idx }}" data-column="{{ col_idx }}"
                >
                </div>
            {% endfor %}
        {% endfor %}
    </div>

    <script>
        function refreshField() {
            fetch('/game')
                .then(response => response.json())
                .then(field => {
                    for (let row = 0; row < {{ size }}; row++) {
                        for (let col = 0; col < {{ size }}; col++) {
                            const cellDiv = document.querySelector(
                                `.grid-cell[data-row="${row}"][data-column="${col}"]`
                            );
                            cellDiv.className = 'grid-cell';
                            if (field[row][col] !== -1) {
                                cellDiv.classList.add(`player${field[row][col]}`);
                            }
                        }
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // Get all grid cells
        const cells = document.querySelectorAll('.grid-cell');

        // Add click event to each cell
        cells.forEach(cell => {
            cell.addEventListener('click', function() {
                const row = this.getAttribute('data-row');
                const column = this.getAttribute('data-column');

                fetch('/move', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        coords: [row, column],  // Pass coordinates
                        player: document.getElementById('player-number').value,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    refreshField();
                    console.log(data.message);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });

        document.getElementById('start-over-btn').addEventListener('click', function() {
            fetch('/new_game', {
                method: 'POST',
            })
                .then(response => response.json())
                .then(data => {})
                .catch(error => alert(`Error: ${error}`));
        });

        setInterval(refreshField, 1000);
    </script>
</body>
</html>
